{
  "rules": {
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid",
        
        "profile": {
          ".validate": "newData.hasChildren(['email', 'displayName'])"
        },
        
        "gateways": {
          "$gatewayMAC": {
            ".read": "$uid === auth.uid",
            ".write": "$uid === auth.uid || auth != null",
            
            "info": {
              ".validate": "newData.hasChildren(['mac', 'address'])"
            },
            
            "status": {
              ".write": "auth != null"
            },
            
            "routing_table": {
              ".write": "auth != null"
            }
          }
        },
        
        "commands": {
          "$gatewayMAC": {
            ".read": "$uid === auth.uid",
            ".write": "$uid === auth.uid",
            
            "pending": {
              "$commandId": {
                ".validate": "newData.hasChildren(['type', 'timestamp'])"
              }
            },
            
            "processing": {
              ".write": "auth != null"
            },
            
            "completed": {
              ".write": "auth != null"
            },
            
            "failed": {
              ".write": "auth != null"
            }
          }
        },
        
        "command_results": {
          "$gatewayMAC": {
            ".read": "$uid === auth.uid",
            ".write": "auth != null"
          }
        },
        
        "provisioning_sessions": {
          "$gatewayMAC": {
            ".read": "$uid === auth.uid",
            ".write": "auth != null"
          }
        },
        
        "events": {
          ".read": "$uid === auth.uid",
          ".write": "auth != null",
          "$timestamp": {
            ".validate": "newData.hasChildren(['type', 'timestamp'])"
          }
        }
      }
    },
    
    "nodes": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid || auth != null",
        
        "$gatewayMAC": {
          "$nodeId": {
            "latest_data": {
              ".write": "auth != null"
            },
            
            "info": {
              ".write": "$uid === auth.uid || auth != null",
              ".validate": "newData.hasChildren(['nodeId', 'gatewayMAC'])"
            }
          }
        }
      }
    },
    
    "sensor_data": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid || auth != null",
        
        "handheld": {
          ".read": "$uid === auth.uid",
          ".write": "$uid === auth.uid || auth != null",
          
          "$timestamp": {
            ".validate": "newData.hasChildren(['soilTemperature', 'soilMoisture', 'timestamp'])"
          }
        },
        
        "$nodeId": {
          ".read": "$uid === auth.uid",
          ".write": "$uid === auth.uid || auth != null",
          
          "$timestamp": {
            ".validate": "newData.hasChildren(['soilTemperature', 'soilMoisture', 'timestamp'])"
          }
        }
      }
    },
    
    "gateways": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid || auth != null",
        
        "$gatewayMAC": {
          "status": {
            ".write": "auth != null"
          },
          
          "routing_table": {
            ".write": "auth != null"
          }
        }
      }
    }
  }
}
